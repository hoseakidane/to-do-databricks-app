bundle:
  name: databricks_app_bundle_testing

variables:
  prod_root_path:
    description: "Prod deployment path"
    default: "/Workspace/Users/hosea.kidane@databricks.com/.bundle/databricks_app_bundle_testing/prod"
  prod_users:
    description: "App users"
    default: "hosea.kidane@databricks.com"
  prod_sp:
    description: "Prod SP app id or uuid for deployment and changes"
    default: "4c9263a0-4412-452a-a613-5394dbe10e3a" 

permissions:
  - group_name: users
    level: CAN_VIEW

resources:
  
  database_instances:
    todo_db:
      name: todo-list-db-${bundle.target} 
      capacity: CU_1

  database_catalogs:
    todo_catalog: 
      database_instance_name: ${resources.database_instances.todo-db.name}
      name: todo_catalog
      database_name: todo_database
      create_database_if_not_exists: true

  apps:
    todo_list_app_bundle:
      name: 'todo-list-app'
      source_code_path: .
      description: 'Todo list app for testing app bundle deployment'
      permissions:
        - user_name: ${var.prod_users}
          level: CAN_USE
      resources:  
        - name: database
          database:
            instance_name: ${resources.database_instances.todo-db.name}
            database_name: ${resources.database_catalogs.todo_catalog.database_name}
            permission: CAN_CONNECT_AND_CREATE


targets:
  dev:
    mode: development
    default: true
    workspace:
      profile: DEFAULT
    permissions:
      - user_name: ${var.prod_users}
        level: CAN_MANAGE

  prod:
    mode: production
    workspace:
      host: https://fe-sandbox-serverless-182sr3.cloud.databricks.com/
      root_path: ${var.prod_root_path}
    permissions:
      - service_principal_name: ${var.prod_sp}
        level: CAN_MANAGE 

